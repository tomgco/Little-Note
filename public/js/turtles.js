var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-27977966-1"]);_gaq.push(["_trackPageview"]);(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();(function(a){function b(){var a=this,e=setTimeout(function(){a.$element.unbind(f);d.call(a)},500);this.$element.one(f,function(){clearTimeout(e);d.call(a)})}function d(){this.$element.hide().trigger("hidden");j.call(this)}function j(c){var e=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.settings.backdrop){var b=a.support.transition&&e;this.$backdrop=a('<div class="modal-backdrop '+e+'" />').appendTo(document.body);"static"!=this.settings.backdrop&&this.$backdrop.click(a.proxy(this.hide,
this));this.$backdrop.addClass("in");b?this.$backdrop.one(f,c):c()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(f,a.proxy(g,this)):g.call(this)):c&&c()}function g(){this.$backdrop.remove();this.$backdrop=null}function h(){var c=this;this.isShown&&this.settings.keyboard?a(document).bind("keyup.modal",function(a){27==a.which&&c.hide()}):this.isShown||a(document).unbind("keyup.modal")}var f;a(document).ready(function(){var c=
(document.body||document.documentElement).style;a.support.transition=void 0!==c.transition||void 0!==c.WebkitTransition||void 0!==c.MozTransition||void 0!==c.MsTransition||void 0!==c.OTransition;a.support.transition&&(f="TransitionEnd",a.browser.webkit?f="webkitTransitionEnd":a.browser.mozilla?f="transitionend":a.browser.opera&&(f="oTransitionEnd"))});var k=function(c,b){this.settings=a.extend({},a.fn.modal.defaults,b);this.$element=a(c).delegate(".close","click.modal",a.proxy(this.hide,this));this.settings.show&&
this.show();return this};k.prototype={toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var c=this;this.isShown=!0;this.$element.trigger("show");h.call(this);j.call(this,function(){var b=a.support.transition&&c.$element.hasClass("fade");c.$element.appendTo(document.body).show();c.$element.addClass("in");b?c.$element.one(f,function(){c.$element.trigger("shown")}):c.$element.trigger("shown")});return this},hide:function(c){c&&c.preventDefault();if(!this.isShown)return this;
this.isShown=!1;h.call(this);this.$element.trigger("hide").removeClass("in");a.support.transition&&this.$element.hasClass("fade")?b.call(this):d.call(this);return this}};a.fn.modal=function(c){var b=this.data("modal");if(!b)return"string"==typeof c&&(c={show:/show|toggle/.test(c)}),this.each(function(){a(this).data("modal",new k(this,c))});if(!0===c)return b;if("string"==typeof c)b[c]();else b&&b.toggle();return this};a.fn.modal.Modal=k;a.fn.modal.defaults={backdrop:!1,keyboard:!1,show:!1};a(document).ready(function(){a("body").delegate("[data-controls-modal]",
"click",function(c){c.preventDefault();c=a(this).data("show",!0);a("#"+c.attr("data-controls-modal")).modal(c.data())})})})(window.jQuery||window.ender);(function(a){function b(a,b){b.find("> .active").removeClass("active").find("> .dropdown-menu > .active").removeClass("active");a.addClass("active");a.parent(".dropdown-menu")&&a.closest("li.dropdown").addClass("active")}function d(d){var g=a(this),h=g.closest("ul:not(.dropdown-menu)"),f=g.attr("href");/^#\w+/.test(f)&&(d.preventDefault(),g.parent("li").hasClass("active")||(d=h.find(".active a").last()[0],f=a(f),b(g.parent("li"),h),b(f,f.parent()),g.trigger({type:"change",relatedTarget:d})))}a.fn.tabs=
a.fn.pills=function(b){return this.each(function(){a(this).delegate(b||".tabs li > a, .pills > li > a","click",d)})};a(document).ready(function(){a("body").tabs("ul[data-tabs] li > a, ul[data-pills] > li > a")})})(window.jQuery||window.ender);(function(a){function b(b){if("string"===typeof b.data){var j=b.handler,g=b.data.toLowerCase().split(" "),h=!1;b.handler=function(b){if(!(this!==b.target&&(/textarea|select/i.test(b.target.nodeName)||"text"===b.target.type||"password"===b.target.type))){var d="keypress"!==b.type&&a.hotkeys.specialKeys[b.which],c=String.fromCharCode(b.which).toLowerCase(),e="",i={};b.altKey&&"alt"!==d&&(e+="alt+");b.ctrlKey&&"ctrl"!==d&&(e+="ctrl+");"command"===a.hotkeys.specialKeys[b.which]&&(h=!0);b.metaKey&&!b.ctrlKey&&
"meta"!==d&&"command"!==d&&(e=h?e+"command+":e+"meta+");b.shiftKey&&"shift"!==d&&(e+="shift+");d?i[e+d]=!0:(i[e+c]=!0,i[e+a.hotkeys.shiftNums[c]]=!0,"shift+"===e&&(i[a.hotkeys.shiftNums[c]]=!0));d=0;for(c=g.length;d<c;d++)if(i[g[d]])return h=!1,j.apply(this,arguments)}}}}a.hotkeys={version:"0.8.1",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",
45:"insert",46:"del",91:"command",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};a.each(["keydown","keyup","keypress"],function(){a.event.special[this]=
{add:b}})})(jQuery);var library,filenameInEdit=!1,siteLocation="",defaultNewPath="New_Note.txt",path=defaultNewPath,bNewNote=!0;
function init(){loadNotes();$("#deleteConfirm").modal({keyboard:!0,backdrop:!0});$("#newConfirm").modal({keyboard:!0,backdrop:!0});$("#btn_new").click(newNote);$("#btn_saveAndNew").click(function(a){saveNote(a,function(){newNote(a)});a.preventDefault()});$("#btn_del").click(deleteNote);$("#btn_save").click(saveNote);$("#btn_close").click(function(a){$("#deleteConfirm").modal("hide");a.preventDefault()});$("#preview").click(function(){$("#editNote").trigger("click")});$(".tabs").bind("change",function(a){switch($(a.target).attr("href")){case "#preview":getPreview()}});
$(".tabs").tabs();setUpKeyboardShortcuts()}function getPreview(){$.ajax({url:siteLocation+"/api/preview",type:"POST",data:{html:$("textarea").val()},dataType:"html",statusCode:{403:function(){}},success:function(a){$("#preview").html(a)}})}
function loadNotes(){library=[];$.ajax({url:siteLocation+"/api/list/all",dataType:"json",success:function(a){for(var b="",d=0;d<a.length;++d)a[d].is_dir||(path=a[d].path.substring(1),b+=makeNote(path),library[path]=a[d]);$("#list ul").html(b);$("#list ul li").live("click",loadNote);0>=$("#list ul li").length?firstRun():(bNewNote=!1,$("#list ul li").first().trigger("click"))}})}
function loadNote(){var a=$(this);filenameInEdit=path=a.data("filename");$.ajax({url:siteLocation+"/api/get/"+path,statusCode:{403:function(){fail("Logged out: save before redirecting!!")}},success:function(b){$("#list ul li").removeClass("selected");a.addClass("selected");$("#notehead").html(fileToTitle(path));b=jQuery.parseJSON(b);$("textarea").val(b.fileContent);$("small.date").text(b.formattedDate);getPreview();$("#tab_preview").trigger("click")}})}
function renameNote(a,b){$.ajax({url:siteLocation+"/api/move/"+a,type:"POST",data:{to:b},statusCode:{403:function(){toggleSaveBtn("failed")}},success:function(){$("#list ul li.selected").data("filename",b);$("#list ul li.selected").html($('<a href="#">').text(fileToTitle(b)));a=filenameInEdit=b}})}function checkForFileRename(a,b){return a!==b?!0:!1}
function saveNote(a,b){toggleSaveBtn("save");bNewNote&&(path=titleToFile($("#notehead").text()));$.ajax({url:siteLocation+"/api/put/"+path,type:"POST",data:{data:$("textarea").val()},statusCode:{403:function(){toggleSaveBtn("failed")}},success:function(){var a=titleToFile($("#notehead").text());checkForFileRename(path,a)&&!bNewNote&&renameNote(path,a);bNewNote&&($("#list ul li").removeClass("selected"),$("#list ul").append($(makeNote(path)).addClass("selected")));toggleSaveBtn();bNewNote=!1;"function"===
typeof b&&b()}})}function newNote(a){path=defaultNewPath;bNewNote=!0;filenameInEdit=path;$("#notehead").html(fileToTitle(path));$("textarea").val("");$("small.date").text("");$("#newConfirm").modal("hide");a.preventDefault()}
function deleteNote(a){$.ajax({url:siteLocation+"/api/del/"+path,statusCode:{403:function(){fail("Logged out: save before redirecting!!")}},success:function(){$("#list ul li.selected").remove();$("#list ul li").removeClass("selected");$("#notehead").html("");$("textarea").val("");$("small.date").text("");$("#deleteConfirm").modal("hide");0>=$("#list ul li").length?firstRun():$("#list ul li").first().trigger("click")}});a.preventDefault()}
function fail(a){alert("toms fault: "+a);window.location=siteLocation+"/try-again"}function makeNote(a){return'<li data-filename="'+a+'"><a href="#">'+fileToTitle(a)+"</a></li>"}function fileToTitle(a){return a.replace(/_/g," ").replace(".txt","")}function titleToFile(a){return a.replace(/ /g,"_")+".txt"}
var toggleSaveBtn=function(a){switch(a){case "save":$("#btn_save").switchClass("primary","success",250,function(){$("#btn_save").text("Saving")});break;case "failed":$("#btn_save").switchClass("success","danger",250,function(){$("#btn_save").text("Failed")});setTimeout(function(){$("#btn_save").switchClass("danger","primary",250,function(){$("#btn_save").text("Save")})},3E3);break;default:$("#btn_save").switchClass("success","primary",250,function(){$("#btn_save").text("Save")})}},firstRun=function(){path=
"Welcome.txt";bNewNote=!0;filenameInEdit=path;$("#notehead").html(fileToTitle(path));$("textarea").val("Welcome to Little Note.\n\nTo start straight away click on me.\n\nLittle Note allows you to create lists, todo and reminders.");getPreview();saveNote()},setUpKeyboardShortcuts=function(){$(window).bind("keydown","command+s",function(a){saveNote();a.preventDefault()});$(window).bind("keydown","ctrl+s",function(a){saveNote();a.preventDefault()});$(window).bind("keydown","command+shift+n",function(a){$("#newConfirm").modal("show");
a.preventDefault()});$(window).bind("keydown","ctrl+shift+n",function(a){$("#newConfirm").modal("show");a.preventDefault()});$("textarea").bind("keydown","command+s",function(a){saveNote();a.preventDefault()});$("textarea").bind("keydown","ctrl+s",function(a){saveNote();a.preventDefault()});$("textarea").bind("keydown","command+shift+n",function(a){$("#newConfirm").modal("show");a.preventDefault()});$("textarea").bind("keydown","ctrl+shift+n",function(a){$("#newConfirm").modal("show");a.preventDefault()})};
$(function(){init()});
